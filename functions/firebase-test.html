<!DOCTYPE html>
<html>
<head>
    <title>Firebase Functions í…ŒìŠ¤íŠ¸</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-functions-compat.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5; 
        }
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        .test-section { 
            margin: 20px 0; 
            padding: 20px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            background: #fafafa; 
        }
        .button { 
            background: #4285f4; 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 6px; 
            cursor: pointer; 
            margin: 8px; 
            font-size: 14px; 
        }
        .button:hover { background: #3367d6; }
        .button.success { background: #34a853; color: white; }
        .button.warning { background: #fbbc04; color: #333; }
        .result { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 6px; 
            margin-top: 15px; 
            font-family: monospace; 
            white-space: pre-wrap; 
            border-left: 4px solid #4285f4; 
            max-height: 400px;
            overflow-y: auto;
        }
        .error { 
            background: #fdf2f2; 
            color: #d73a49; 
            border-left-color: #d73a49; 
        }
        .success { 
            background: #f0fff4; 
            color: #28a745; 
            border-left-color: #28a745; 
        }
        h1 { color: #333; text-align: center; }
        h3 { color: #4285f4; border-bottom: 2px solid #4285f4; padding-bottom: 8px; }
        .status { 
            padding: 8px 16px; 
            border-radius: 20px; 
            font-size: 12px; 
            font-weight: bold; 
            margin: 10px 0;
        }
        .status.connected { background: #d4edda; color: #155724; }
        .status.disconnected { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Firebase Functions í…ŒìŠ¤íŠ¸</h1>
        
        <!-- ì—°ê²° ìƒíƒœ -->
        <div class="test-section">
            <h3>ğŸ“¡ Firebase ì—°ê²°</h3>
            <div id="connectionStatus" class="status disconnected">ë¯¸ì—°ê²°</div>
            <button class="button" onclick="initializeFirebase()">Firebase ì´ˆê¸°í™”</button>
            <div id="initResult" class="result">Firebase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤</div>
        </div>

        <!-- í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤ -->
        <div class="test-section">
            <h3>ğŸ”§ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤</h3>
            <button class="button success" onclick="test1()">1. test_simple (ê°€ì¥ ê¸°ë³¸)</button>
            <button class="button success" onclick="test2()">2. test_auth (ì¸ì¦ í…ŒìŠ¤íŠ¸)</button>
            <button class="button success" onclick="test3()">3. test_config (í™˜ê²½ë³€ìˆ˜)</button>
            <button class="button success" onclick="test4()">4. test_firestore (DB í…ŒìŠ¤íŠ¸)</button>
            <div id="testResult" class="result">í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
        </div>

        <!-- ì‹¤ì œ í•¨ìˆ˜ë“¤ -->
        <div class="test-section">
            <h3>ğŸš€ ì‹¤ì œ êµ¬ë… í•¨ìˆ˜ë“¤</h3>
            <button class="button warning" onclick="testSubscription()">checkSubscriptionStatus</button>
            <button class="button warning" onclick="testGetAll()">getAllSubscriptionStatuses</button>
            <div id="subscriptionResult" class="result">êµ¬ë… í•¨ìˆ˜ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
        </div>
    </div>

    <script>
        let app, functions;
        
        function initializeFirebase() {
            try {
                // Firebase ì„¤ì • (ì‹¤ì œ í”„ë¡œì íŠ¸ ì •ë³´ë¡œ ìˆ˜ì • í•„ìš”)
                const firebaseConfig = {
                    apiKey: "AIzaSyARF9UnTtIinsWCmLnG6YX8OZatumrT1UE", // ì—¬ê¸°ì— ì‹¤ì œ API Key ì…ë ¥
                    authDomain: "mylingowith.firebaseapp.com",
                    projectId: "mylingowith",
                };
                
                app = firebase.initializeApp(firebaseConfig);
                functions = firebase.functions();
                
                
                document.getElementById('connectionStatus').textContent = 'ì—°ê²°ë¨';
                document.getElementById('connectionStatus').className = 'status connected';
                document.getElementById('initResult').className = 'result success';
                document.getElementById('initResult').textContent = 'âœ… Firebase ì´ˆê¸°í™” ì™„ë£Œ!';
                
                console.log('Firebase ì´ˆê¸°í™” ì„±ê³µ');
            } catch (error) {
                document.getElementById('initResult').className = 'result error';
                document.getElementById('initResult').textContent = 'âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨: ' + error.message;
                console.error('Firebase ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
            }
        }
        
        function showResult(elementId, message, isError = false) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = isError ? 'result error' : 'result success';
        }
        
        function test1() {
            if (!functions) {
                showResult('testResult', 'âŒ ë¨¼ì € Firebaseë¥¼ ì´ˆê¸°í™”í•˜ì„¸ìš”', true);
                return;
            }
            
            showResult('testResult', 'ğŸ”„ test_simple í…ŒìŠ¤íŠ¸ ì¤‘...');
            
            const testSimple = functions.httpsCallable('test_simple');
            testSimple({message: "hello from browser", test: "data"})
                .then((result) => {
                    showResult('testResult', 'âœ… test_simple ì„±ê³µ!\n\n' + JSON.stringify(result.data, null, 2));
                })
                .catch((error) => {
                    showResult('testResult', 
                        'âŒ test_simple ì‹¤íŒ¨!\n\n' + 
                        'Code: ' + error.code + '\n' +
                        'Message: ' + error.message + '\n' +
                        'Details: ' + JSON.stringify(error.details, null, 2), true);
                });
        }
        
        function test2() {
            if (!functions) {
                showResult('testResult', 'âŒ ë¨¼ì € Firebaseë¥¼ ì´ˆê¸°í™”í•˜ì„¸ìš”', true);
                return;
            }
            
            showResult('testResult', 'ğŸ”„ test_auth í…ŒìŠ¤íŠ¸ ì¤‘...');
            
            const testAuth = functions.httpsCallable('test_auth');
            testAuth({test: "auth test", user: "browser_user"})
                .then((result) => {
                    showResult('testResult', 'âœ… test_auth ì„±ê³µ!\n\n' + JSON.stringify(result.data, null, 2));
                })
                .catch((error) => {
                    showResult('testResult', 
                        'âŒ test_auth ì‹¤íŒ¨!\n\n' + 
                        'Code: ' + error.code + '\n' +
                        'Message: ' + error.message + '\n' +
                        'Details: ' + JSON.stringify(error.details, null, 2), true);
                });
        }
        
        function test3() {
            if (!functions) {
                showResult('testResult', 'âŒ ë¨¼ì € Firebaseë¥¼ ì´ˆê¸°í™”í•˜ì„¸ìš”', true);
                return;
            }
            
            showResult('testResult', 'ğŸ”„ test_config í…ŒìŠ¤íŠ¸ ì¤‘...');
            
            const testConfig = functions.httpsCallable('test_config');
            testConfig({})
                .then((result) => {
                    showResult('testResult', 'âœ… test_config ì„±ê³µ!\n\n' + JSON.stringify(result.data, null, 2));
                })
                .catch((error) => {
                    showResult('testResult', 
                        'âŒ test_config ì‹¤íŒ¨!\n\n' + 
                        'Code: ' + error.code + '\n' +
                        'Message: ' + error.message + '\n' +
                        'Details: ' + JSON.stringify(error.details, null, 2), true);
                });
        }
        
        function test4() {
            if (!functions) {
                showResult('testResult', 'âŒ ë¨¼ì € Firebaseë¥¼ ì´ˆê¸°í™”í•˜ì„¸ìš”', true);
                return;
            }
            
            showResult('testResult', 'ğŸ”„ test_firestore í…ŒìŠ¤íŠ¸ ì¤‘...');
            
            const testFirestore = functions.httpsCallable('test_firestore');
            testFirestore({test: "firestore connection"})
                .then((result) => {
                    showResult('testResult', 'âœ… test_firestore ì„±ê³µ!\n\n' + JSON.stringify(result.data, null, 2));
                })
                .catch((error) => {
                    showResult('testResult', 
                        'âŒ test_firestore ì‹¤íŒ¨!\n\n' + 
                        'Code: ' + error.code + '\n' +
                        'Message: ' + error.message + '\n' +
                        'Details: ' + JSON.stringify(error.details, null, 2), true);
                });
        }
        
        function testSubscription() {
            if (!functions) {
                showResult('subscriptionResult', 'âŒ ë¨¼ì € Firebaseë¥¼ ì´ˆê¸°í™”í•˜ì„¸ìš”', true);
                return;
            }
            
            showResult('subscriptionResult', 'ğŸ”„ checkSubscriptionStatus í…ŒìŠ¤íŠ¸ ì¤‘...');
            
            const checkStatus = functions.httpsCallable('sub_checkSubscriptionStatus');
            checkStatus({})
                .then((result) => {
                    showResult('subscriptionResult', 'âœ… checkSubscriptionStatus ì„±ê³µ!\n\n' + JSON.stringify(result.data, null, 2));
                })
                .catch((error) => {
                    showResult('subscriptionResult', 
                        'âŒ checkSubscriptionStatus ì‹¤íŒ¨!\n\n' + 
                        'Code: ' + error.code + '\n' +
                        'Message: ' + error.message + '\n' +
                        'Details: ' + JSON.stringify(error.details, null, 2), true);
                });
        }
        
        function testGetAll() {
            if (!functions) {
                showResult('subscriptionResult', 'âŒ ë¨¼ì € Firebaseë¥¼ ì´ˆê¸°í™”í•˜ì„¸ìš”', true);
                return;
            }
            
            showResult('subscriptionResult', 'ğŸ”„ getAllSubscriptionStatuses í…ŒìŠ¤íŠ¸ ì¤‘...');
            
            const getAllStatus = functions.httpsCallable('sub_getAllSubscriptionStatuses');
            getAllStatus({originalTransactionId: "test-transaction-id"})
                .then((result) => {
                    showResult('subscriptionResult', 'âœ… getAllSubscriptionStatuses ì„±ê³µ!\n\n' + JSON.stringify(result.data, null, 2));
                })
                .catch((error) => {
                    showResult('subscriptionResult', 
                        'âŒ getAllSubscriptionStatuses ì‹¤íŒ¨!\n\n' + 
                        'Code: ' + error.code + '\n' +
                        'Message: ' + error.message + '\n' +
                        'Details: ' + JSON.stringify(error.details, null, 2), true);
                });
        }
    </script>
</body>
</html>